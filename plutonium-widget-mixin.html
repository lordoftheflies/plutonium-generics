<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer-element.html">
<script>
    (function () {

        'use strict';

        // Create my namespace, if it doesn't exist
        if (!window.Plutonium) {
            window.Plutonium = {};
        }

        Plutonium.LightCompositionError = class LightCompositionError extends Error {
            constructor(host, subject) {
                super(host + ' element is not contain identified element ' + subject);
            }
        }

        Plutonium.WidgetMixin = Polymer.dedupingMixin((base) => class extends base {
            static get properties() {
                return {
                    backendUrl: String,
                    django: {
                        type: Boolean,
                        notify: true,
                        reflectToAttribute: true,
                        value: () => false
                    }
                }
            }

            constructor() {
                super();
                console.debug(this.fqen, 'is created');
            }

            ready() {
                super.ready();
                console.debug(this.fqen, 'is ready');
            }

            connectedCallback() {
                super.connectedCallback();
                console.debug(this.fqen, 'is attached');
            }

            disconnectedCallback() {
                console.debug(this.fqen, 'is detached');
                super.disconnectedCallback();
            }

            get fqen() {
                return (this.id) ? (this.localName + '#' + this.id) : this.localName;
            }

            initializeProperty(propertyName, initial) {
                if (!this.get(propertyName)) {
                    this.set(propertyName, initial);
                    console.log(this.fqdn, 'initialize', propertyName, initial);
                }
            }

            capitalizeFirstLetter(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }

            strongShadowDomConstraint(id, elementType) {
                let element = this.$[id];
                if (element) {
                    console.debug(this.fqen, 'satisfy shadow-dom constraint, has element', (elementType) ? elementType + '#' + id : '#' + id);
                } else {
                    console.warn(this.fqen, 'violate shadow-dom constraint');
                    throw new LightCompositionError(this.fqen, id);
                }
            }

            weakShadowDomConstraint(id, elementType) {
                try {
                    this.strongShadowDomConstraint(id, elementType);
                } catch (e) {
                    if (e instanceof Plutonium.LightCompositionError) {
                        console.warn(e.message);
                    } else {
                        throw e;
                    }
                }
            }
        });

    })();
</script>